<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />

    <!-- 新 Bootstrap 核心 CSS 文件 -->
    <link rel="stylesheet" href="http://cdn.bootcss.com/bootstrap/3.3.0/css/bootstrap.min.css">
    <!-- jQuery文件。务必在bootstrap.min.js 之前引入 -->
    <script src="http://cdn.bootcss.com/jquery/1.11.1/jquery.min.js"></script>
    <!-- 最新的 Bootstrap 核心 JavaScript 文件 -->
    <script src="http://cdn.bootcss.com/bootstrap/3.3.0/js/bootstrap.min.js"></script>

    <script type="text/javascript"></script>

    <title>Gamedev Canvas Workshop</title>
    <style>
        * {
            padding: 0;
            margin: 0;
        }

        canvas {
            background: #eee;
            display: block;
            margin: 0 auto;
        }

        #myCanvas {
            background-image: url(asset/bg.jpg);
            background-size: cover;
            background-repeat: no-repeat;
            background-position: center center;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="row">
            <video id="myVideo" class="col-md-12 col-xs-12" controls>
                <source src=asset/video.mp4 type=video/mp4>
            </video>
        </div>
        <div class="row">
            <canvas id="myCanvas" class="col-md-12 col-xs-12" width="1280" height="720"></canvas>
        </div>

    </div>

    <script>

        var v = document.getElementById("myVideo");

        var canvas = document.getElementById("myCanvas");
        var ctx = canvas.getContext("2d");

        canvas.addEventListener("mousedown", onMouseDown);

        var x = canvas.width;
        var y = canvas.height;

        var userX = 0;
        var userY = 0;
        var start = { status: 0, name: "   start" };
        var btnX = canvas.width / 2;
        var btnY = canvas.height / 2;
        var btnWidth = 200;
        var btnHeight = 100;

        var squX = 0;
        var squY = x*2/5;
        var squWidth = x;
        var squHeight = y/4;

        var cornerRadius = 10;
        var step = true;

        var img1 = new Image();
        img1.src = 'asset/Iris.png';

        var img2 = new Image();
        img2.src = 'asset/Lora.png';

        var imgReturn = new Image();
        imgReturn.src = 'asset/return.png'

        var option = [];
        for (var c = 0; c < 6; c++) {
            option[c] = [];
            for (var r = 0; r < 4; r++) {
                option[c][r] = { };
            }
        }
        option[0][0] = { status: -1, name: "popcorn"};
        option[0][1] = { status: -1, name: "stamps" };
        option[0][2] = { status: -2, name: "prizes" };
        option[0][3] = { status: -1, name: "careers" };

        option[1][0] = { status: -2, name: "That' s not true." };
        option[1][1] = { status: -1, name: "Neither did I." };
        option[1][2] = { status: -1, name: "You are so right." };
        option[1][3] = { status: -1, name: "How can that be ?" };

        option[2][0] = { status: -1, name: "either could" };
        option[2][1] = { status: -2, name: "neither could" };
        option[2][2] = { status: -1, name: "either couldn't" };
        option[2][3] = { status: -1, name: "so couldn't" };
        
        option[3][0] = { status: -1, name: "always forget about my worries" };
        option[3][1] = { status: -1, name: "eat a good pumpkin pie now" };
        option[3][2] = { status: -1, name: "be a rich businesswoman" };
        option[3][3] = { status: -2, name: "look on the bright side of life" };

        option[4][0] = { status: -1, name: "steamed" };
        option[4][1] = { status: -1, name: "fried" };
        option[4][2] = { status: -2, name: "baked" };
        option[4][3] = { status: -1, name: "cooked" };
        
        option[5][0] = { status: -2, name: "so can I" };
        option[5][1] = { status: -1, name: "also can I" };
        option[5][2] = { status: -1, name: "also am I" };
        option[5][3] = { status: -1, name: "so am I" };

        var check = "start";

        // Mouse event handlers
        function onMouseDown(e) {
            // Get the mouse position
            var pos = getMousePos(canvas, e);
            userX = pos.x;
            userY = pos.y;
        }

        // Get the mouse position
        function getMousePos(canvas, e) {
            var rect = canvas.getBoundingClientRect();
            return {
                x: Math.round((e.clientX - rect.left) / (rect.right - rect.left) * canvas.width),
                y: Math.round((e.clientY - rect.top) / (rect.bottom - rect.top) * canvas.height)
            };
        }

        function drawScore() {
            ctx.font = "64px Arial";
            ctx.fillStyle = "black";
            //ctx.fillText("x: " + x, 20, 20);
            //ctx.fillText("y: " + y, 20, 40);
            //ctx.fillText("mx: " + userX, 20, 60);
            //ctx.fillText("my: " + userY, 20, 80);
            if(check == "no")
            ctx.fillText(check, 20, 160);
            //ctx.fillText("status: " + start.status, 20, 120);
        }

        function drawSquare(x, y, w, h, ob) {

            ctx.beginPath();
            ctx.rect(x, y, w, h);
            ctx.fillStyle = "#FFFFFF";
            ctx.fill();
            ctx.closePath();

            ctx.lineJoin = "round";
            ctx.lineWidth = cornerRadius;
            ctx.strokeRect(x + (cornerRadius / 2), y + (cornerRadius / 2), w - cornerRadius, h - cornerRadius);
        }

        function drawBtn(x, y, w, h, ob) {

            var fixX = x - w / 2;
            var fixY = y - h / 2;

            ctx.beginPath();
            ctx.rect(fixX, fixY, w, h);
            ctx.fillStyle = "#FFFFFF";
            ctx.fill();
            ctx.closePath();

            ctx.lineJoin = "round";
            ctx.lineWidth = cornerRadius;
            ctx.stroke();

            
            drawText(ob.name, fixX, fixY+5);
      
            if (userX > fixX && userY > fixY && userX < fixX + w && userY < fixY + h) {
                if (ob.status == 0) {
                    check = "click";
                    ob.status = 1;
                }
                if (ob.status == -1) {
                    check = "no";
                }
                if (ob.status == -2) {
                    check = "yes";
                }
            }
        }

        function drawText(text, x, y, ob) {
            ctx.font = "36px 微軟正黑體";
            ctx.fillStyle = "black";
            ctx.fillText(text, x + 35, y + 55);
        }

        function drawReturn() {
            if (start.status > 2 && step) {

                ctx.drawImage(imgReturn, 0, 0, 100, 100);
                if (userX > 0 && userY > 0 && userX < imgReturn.width && userY < imgReturn.height) {
                    start.status -= 2;
                }
            }
        }
        function drawImg() {
            if (start.status >= 3) {
                ctx.drawImage(img1, 0, 0);
            }
            if (start.status >= 4) {
                ctx.drawImage(img2, canvas.width - 600, 0);
            }
        }
        function changeImg(name, face) {

            if (name == "Iris") {
                switch (face) {
                    case "normal":
                        img1.src = 'asset/Iris.png';
                        break;
                    case "cry":
                        img1.src = 'asset/Iris_cry.png';
                        break;
                    case "surprice":
                        img1.src = 'asset/Iris_surprice';
                        break;
                    case "laught":
                        img1.src = 'asset/Iris_laught';
                        break;
                }
            }
            if (name == "Lora") {
                switch (face) {
                    case "normal":
                        img2.src = 'asset/Lora.png';
                        break;
                    case "laught":
                        img2.src = 'asset/Lora_laught';
                        break;
                }
            }            
        }

        function main() {
            if (start.status == 0) {
                drawBtn(btnX, btnY, btnWidth, btnHeight, start);
            }
            if (start.status >= 1) {
                
                drawSquare(squX, squY, squWidth, squHeight, start);

                if (start.status >= 2 && start.status < 5) {
                    
                    drawText("故事背景 : ", squX, squY, start);
                }

                if (start.status == 3) {
                    drawText("艾莉詩電競比賽輸了，覺得自己一無是處。", squX, squY + 70, start);
                    
                }

                else if (start.status == 4) {
                    drawText("因此蘿拉以她很會做糕點安慰她，並勸其多看生命正向的部分。", squX, squY + 70, start);
                }

                if (start.status >= 5 && start.status < 9) {
                    drawText("Iris: ", squX, squY, start);
                }

                if (start.status >= 5 && start.status < 7) {
                    drawText("Today is not my day, I didn't win any ____ on my E-sports competition.", squX, squY + 70, start);
                    changeImg("Iris","cry");
                    //img1.src = 'asset/Iris_cry.png';
                }

                if (start.status == 6) {
                    step = false;
                    drawBtn(btnX, 80, btnWidth, btnHeight, option[0][0]);
                    drawBtn(btnX, 200, btnWidth, btnHeight, option[0][1]);
                    drawBtn(btnX, 320, btnWidth, btnHeight, option[0][2]);
                    drawBtn(btnX, 440, btnWidth, btnHeight, option[0][3]);
                }

                if (start.status == 7) {
                    drawText("Today is not my day, I didn't win any " + option[0][2].name+" on my E-sports competition.", squX, squY + 70, start);
                }

                if (start.status == 8) {
                    drawText("See, I' m poor at everything. I just can't do anything right.", squX, squY + 70, start);
                }
                
                if (start.status >= 9 && start.status < 18) {
                    drawText("Lora: ", squX, squY, start);
                }

                if (start.status >= 9 && start.status < 11) {
                    drawText("______", squX, squY + 70, start);
                }

                if (start.status == 10) {
                    step = false;
                    drawBtn(btnX, 80, btnWidth + 150, btnHeight, option[1][0]);
                    drawBtn(btnX, 200, btnWidth + 150, btnHeight, option[1][1]);
                    drawBtn(btnX, 320, btnWidth + 150, btnHeight, option[1][2]);
                    drawBtn(btnX, 440, btnWidth + 150, btnHeight, option[1][3]);
                }

                if (start.status == 11) {
                    drawText(option[1][0].name, squX, squY + 70, start);
                }

                if (start.status == 12) {
                    drawText("Don't you remember the delicious pumpkin pie you make ...", squX, squY + 70, start);
                }

                if (start.status == 13) {
                    drawText("for our party last time ?", squX, squY + 70, start);
                }

                if (start.status >= 14 && start.status < 16) {
                    drawText("Everyone couldn't stop eating it,and ______ Jeff(a person that Iris love).", squX, squY + 70, start);
                }
                
                if (start.status == 15) {
                    step = false;
                    drawBtn(btnX, 80, btnWidth + 150, btnHeight, option[2][0]);
                    drawBtn(btnX, 200, btnWidth + 150, btnHeight, option[2][1]);
                    drawBtn(btnX, 320, btnWidth + 150, btnHeight, option[2][2]);
                    drawBtn(btnX, 440, btnWidth + 150, btnHeight, option[2][3]);
                }

                if (start.status == 16) {
                    drawText("Everyone couldn't stop eating it...", squX, squY + 70, start);
                }

                if (start.status == 17) {
                    drawText("and "+option[2][1].name+" Jeff ( a person that Iris love ).", squX, squY + 70, start);
                }

                if (start.status >= 18 && start.status < 21) {
                    drawText("Iris: ", squX, squY, start);
                }

                if (start.status >= 18 && start.status < 20) {
                    drawText("Really? Maybe I should cheer up and _____. ", squX, squY + 70, start);
                    changeImg("Iris", "surprice");
                    //img1.src = 'asset/Iris_surprice.png';
                }

                if (start.status == 19) {
                    step = false;
                    drawBtn(btnX, 80, btnWidth + 380, btnHeight, option[3][0]);
                    drawBtn(btnX, 200, btnWidth + 380, btnHeight, option[3][1]);
                    drawBtn(btnX, 320, btnWidth + 380, btnHeight, option[3][2]);
                    drawBtn(btnX, 440, btnWidth + 380, btnHeight, option[3][3]);
                }

                if (start.status == 20) {
                    drawText("Really? Maybe I should cheer up and " + option[3][3].name+". ", squX, squY + 70, start);
                }

                if (start.status >= 21 && start.status < 25) {
                    drawText("Lora: ", squX, squY , start);
                }

                if (start.status == 21) {
                    drawText("Trust me! Don't you remember that our teacher ...", squX, squY + 70, start);
                }

                if (start.status >= 22 && start.status < 24) {
                    drawText("also loved the cake you _____ in Teacher's Day? ", squX, squY + 70, start);
                }

                if (start.status == 23) {
                    step = false;
                    drawBtn(btnX, 80, btnWidth, btnHeight, option[4][0]);
                    drawBtn(btnX, 200, btnWidth, btnHeight, option[4][1]);
                    drawBtn(btnX, 320, btnWidth, btnHeight, option[4][2]);
                    drawBtn(btnX, 440, btnWidth, btnHeight, option[4][3]);
                }

                if (start.status == 24) {
                    drawText("also loved the cake you " + option[4][2].name+" in Teacher's Day? ", squX, squY + 70, start);
                }

                if (start.status >= 25 && start.status < 26) {
                    drawText("Iris: ", squX, squY, start);
                }

                if (start.status == 25) {
                    drawText("Oh, it's really my pleasure! Thank you. I become relieved.", squX, squY + 70, start);
                    img1.src = 'asset/Iris_laught.png';
                }

                if (start.status >= 26 && start.status < 29) {
                    drawText("Iris: ", squX, squY, start);
                }

                if (start.status >= 26 && start.status < 28) {
                    drawText(" Seeing you in this way, and _____ feel much better now.", squX, squY + 70, start);
                }

                if (start.status == 27) {
                    step = false;
                    drawBtn(btnX, 80, btnWidth + 20, btnHeight, option[5][0]);
                    drawBtn(btnX, 200, btnWidth + 20, btnHeight, option[5][1]);
                    drawBtn(btnX, 320, btnWidth + 20, btnHeight, option[5][2]);
                    drawBtn(btnX, 440, btnWidth + 20, btnHeight, option[5][3]);
                }

                if (start.status == 28) {
                    drawText(" Seeing you in this way, and " + option[5][0].name+" feel much better now.", squX, squY + 70, start);
                }

                if (start.status >= 29) {
                    drawText("End.", squX, squY, start);
                }
            }
        }
        
        function control() {
            if (check == "yes") {
                check = "click";
                step = true;
            }

            if (userX != 0 && step) {
                start.status += 1;
            }
        }
        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            drawImg();
            changeImg();
            drawReturn();
            main();
            control();

            drawScore();
            userX = 0;
            userY = 0;
        }
        draw();
        setInterval(draw, 50);
    </script>

</body>
</html>